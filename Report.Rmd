---
title: "Influence of Stadium and State Characteristics on Home Winning Percentage"
author: "Clara Livingston and Emily Kaegi"
date: "May 25, 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warnings=FALSE, message = FALSE, prompt = TRUE, comment = NULL, fig.align='center')
library(fiftystater)
library(ggplot2)
library(dplyr)
```

#Introduction

Typically, when looking at statistics related to sports, researchers tend to focus on the dynamics of the team in question when predicting winning percentages. The goal of our research was to take analysis away from factors related to the team and investigate how factors relating to the location of the team's home stadium affects their home winning percentage. Most people are aware of the phrase "homefield advantage", but just how influential is a team's homefield in boosting their win percentages? SBNation and Sporting News both claim that home field advantage is real across most sports, especially the NBA. What appears harder to determine, however, is the cause of variability in this percentage between different sports and teams. 

Instead of focusing on existance of "homefield advantage" we decided to look at what factors relating to a home stadium or arena might be correlated with winning percentage. Specifically, how do characteristics of the arena, franchise, fan base as well as state metrics affect a home team's winning. Are these characteristics consistent across all major league sports? We chose to focus on the NBA, NFL, MLB, and NHL since these professional leagues are the most popular in the United States.

Some of the most interesting potential predictors we wanted to explore were what percentage of a states population voted for Donald Trump in the 2016 presidential election. Does political leaning have any correlation with how well teams play at home? Also, using a metric of states' happiness level, we were curious if happiness is in anyway correlated with winning percentage. Do teams in happier states win more? While we cannot determine if this is casual or even the direction of the relationship (are states happy because their teams win or do players in happy states play better?) it is still interesting to explore.

#Methods

#Results

EDA Paragraphs

To discover the relationship between home game winning percentages and the variables of interest, we used logistic binomial regression. We observed variation in home win percentage by state, but did not want to include a variable for each state, we decided to include state as a random effect in our model. 

Insert a couple sentences about modeling process description?

The heirarchical form of the final model is below. Estimates for the $\beta$ parameters can be found in Table ??. Note that Sport Baseball is the baseline level.

####Level 1 (team level): 
$logodds(homewins) = a_i + \beta_0 Capacity_{ij} + \beta_1 Attendence_{ij} + \beta_2SportBasektball_{ij} + \beta_3SportFootball_{ij} + \beta_4SportHockey_{ij} + \beta_5FranchiseValue_{ij} + \beta_6 YearOpened_{ij} + \beta_7Capacity_{ij}SportBasektball_{ij} + \beta_8Capacity_{ij}SportFootball_{ij} + \beta_9Capacity_{ij}SportHockey_{ij} + + \beta_{10}Attendence_{ij}SportBasektball_{ij} + \beta_{11}Attendence_{ij}SportFootball_{ij} + \beta_{12}Attendence_{ij}SportHockey_{ij} + \beta_{13}Attendence_{ij}Capacity_{ij}$

#### Level 2 (state level): 
$a_i = \alpha_0 + \beta_{14}Population_i + \beta_{15}Happiness_i + \beta_{16}Happiness_{i}Population_{i} + u_i$

Where $u_i$ ~ $Norm(0, \sigma)$. Our model predicted $\hat \sigma =  0.1434$




#Discussion

#Appendix




```{r,fig.cap="Caption Goes Here"}
AllStates <- fifty_states
AllStates$state <- AllStates$id
state <- read.csv("StateData.csv")
statestuff <- data.frame(state.abb,state.name)
colnames(statestuff) <- c("State","StateName")
state <- full_join(state,statestuff)
state$StateName <- as.character(state$StateName)
state <- state%>%mutate(StateAbb=State,State=ifelse(State=="DC","District of Columbia",StateName))
state <- state%>%mutate(state2=tolower(State))
AllData <- read.csv("AllData.csv")
AllData <- AllData%>%mutate(state2=tolower(State),WinPct = HomeWins/HomeGames)
AllData2 <- AllData%>%group_by(state2)%>%summarise(AvgWin=mean(WinPct))

#Population
ggplot() + coord_map() + geom_map(data = state, aes(map_id = state2, fill = Population), map = AllStates) + expand_limits(x = AllStates$long, y = AllStates$lat) + ggtitle("Population By State 2017") + labs(x= "Longitute", y  = "Latitude") +scale_fill_distiller(name = "Population", palette = "BuPu") +theme_classic()

#Happiness
ggplot() + coord_map() + geom_map(data = state, aes(map_id = state2, fill = Happiness), map = AllStates) + expand_limits(x = AllStates$long, y = AllStates$lat) + ggtitle("Happiness By State 2017") + labs(x= "Longitute", y  = "Latitude") +scale_fill_distiller(name = "Happiness", palette = "BuPu") +theme_classic()

state2 <- state%>%filter(StateAbb!="DC")
#Average percent home games won by state
ggplot() + coord_map() + geom_map(data = AllData2, aes(map_id = state2, fill = AvgWin), map = AllStates) + expand_limits(x = AllStates$long, y = AllStates$lat) + ggtitle("Percent Won By State") + labs(x= "Longitute", y  = "Latitude") +scale_fill_distiller(name = "Percent", palette = "BuPu") +theme_classic()
```
